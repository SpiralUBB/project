<h2 mat-dialog-title>Create an event</h2>

<form [formGroup]="eventForm" (ngSubmit)="onSubmit()">
  <mat-dialog-content>
    <div>
      <mat-form-field>
        <mat-label>Title</mat-label>
        <input matInput type="text" formControlName="title" />
      </mat-form-field>

      <mat-form-field floatLabel="never" class="full-width">
        <input matInput type="text" [matAutocomplete]="auto" 
        [formControl]="inputFieldFormControl" placeholder="Enter location here" />
      
        <mat-autocomplete #auto="matAutocomplete" autoActiveFirstOption>
          <mat-option *ngFor="let option of searchOptions | async" [value]="option.shortAddress" 
            (onSelectionChange)="optionSelectionChange(option, $event)"
            [matTooltip]="option.fullAddress" matTooltipShowDelay="1000">
            <span class="mat-body">{{ option.shortAddress }}</span>
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>

      <div
        class="map"
        leaflet
        [leafletOptions]="locationPickerOptions"
        [(leafletCenter)]="mapCenter"
        (leafletMapReady)="onMapReady($event)"
      ></div>

      <div class="double-field-container">
        <mat-form-field class="full-width">
          <mat-label>Coords x</mat-label>
          <input  readonly="true" matInput type="number" formControlName="x" />
        </mat-form-field>

        <mat-form-field class="full-width">
          <mat-label>Coords y</mat-label>
          <input  readonly="true" matInput type="number" formControlName="y" />
        </mat-form-field>
      </div>

      <mat-form-field>
        <mat-label>Start date</mat-label>
        <input matInput [matDatepicker]="startDatePicker" formControlName="startDate" />
        <mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>
        <mat-datepicker #startDatePicker></mat-datepicker>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Start time</mat-label>
        <input matInput type="time" value="12:00 AM" formControlName="startTime" />
      </mat-form-field>

      <mat-form-field>
        <mat-label>End date</mat-label>
        <input matInput [matDatepicker]="endDatePicker" formControlName="endDate" />
        <mat-datepicker-toggle matSuffix [for]="endDatePicker"></mat-datepicker-toggle>
        <mat-datepicker #endDatePicker></mat-datepicker>
      </mat-form-field>

      <mat-form-field>
        <mat-label>End time</mat-label>
        <input matInput type="time" value="12:00 AM" formControlName="endTime" />
      </mat-form-field>

      <mat-form-field>
        <mat-label>Visibility</mat-label>
        <mat-select formControlName="visibility">
          <mat-option value="public">Public</mat-option>
          <mat-option value="whitelisted">Whitelisted</mat-option>
          <mat-option value="unlisted">Unlisted</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Category</mat-label>
        <mat-select formControlName="category">
          <mat-option *ngFor="let category of categories" [value]="category.value">
            {{ category.viewValue }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Minimum Trust level</mat-label>
        <mat-select formControlName="trustLevel">
          <mat-option
            *ngFor="let trustLevelOption of trustLevelOptions"
            [value]="trustLevelOption.value"
          >
            {{ trustLevelOption.viewValue }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <div>
        <mat-checkbox color="primary" (change)="onChangeMaxNrParticipants()">
          <mat-label>Limit participants</mat-label>
        </mat-checkbox>
      </div>

      <mat-form-field *ngIf="showParticipantsLimit">
        <mat-label>Max participants</mat-label>
        <input matInput type="number" formControlName="nrMaxParticipants" />
      </mat-form-field>

      <mat-form-field>
        <mat-label>Description</mat-label>
        <textarea matInput formControlName="description"></textarea>
      </mat-form-field>
    </div>
  </mat-dialog-content>

  <mat-dialog-actions>
    <button [disabled]="!eventForm.valid" type="submit" mat-raised-button color="primary">
      Submit
    </button>
  </mat-dialog-actions>
</form>
